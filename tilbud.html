<!DOCTYPE html>
<html lang="da">
<head>
  <meta charset="UTF-8" />
  <title>Admin Tilbud</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
  <style>
    body { font-family: Arial, sans-serif; background: #f4f4f4; padding: 2em;}
    nav {
      background: #142541;
      color: #fff;
      padding: 1em 2em;
      margin-bottom: 2em;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    nav .logo { font-weight: bold; font-size: 1.4em; }
    nav .links a {
      color: #fff;
      text-decoration: none;
      margin-right: 2em;
      font-size: 1.1em;
      transition: text-decoration 0.2s;
    }
    nav .links a:last-child { margin-right: 0; }
    nav .links a:hover { text-decoration: underline; }
    .search-bar input[type="text"] {
      padding: 6px;
      font-size: 1em;
      border-radius: 4px;
      border: 1px solid #ddd;
    }
    .search-bar button {
      background: #2274A5;
      color: #fff;
      border: none;
      border-radius: 4px;
      padding: 6px 12px;
      margin-left: 4px;
      cursor: pointer;
      font-size: 1em;
    }
    .breadcrumb {
      margin-bottom: 1.5em;
      font-size: 1em;
      color: #666;
    }
    .breadcrumb a {
      color: #2274A5;
      text-decoration: none;
      margin-right: 4px;
    }
    .breadcrumb a:hover {
      text-decoration: underline;
    }
    .breadcrumb span {
      margin: 0 4px;
    }
    form { margin-bottom: 2em; background: #fff; padding: 1em; border-radius: 8px;}
    input, textarea { margin-bottom: 1em; width: 100%; padding: 8px; }
    label { font-weight: bold; }
    .offers-container { 
      display: flex; 
      flex-wrap: wrap; 
      gap: 20px; 
      margin: 0; 
      padding: 0;
    }
    .offer-card {
      background: #fff;
      border-radius: 8px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      padding: 16px;
      width: 320px;
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      position: relative;
      border: 1px solid #ddd;
    }
    .offer-card img { 
      width: 100%; 
      border-radius: 4px; 
      margin-bottom: 10px; 
      object-fit: cover;
    }
    .offer-card h3 { 
      margin: 0 0 8px 0; 
      font-size: 1.1em; 
      color: #142541;
    }
    .offer-card p { 
      margin: 0 0 10px 0; 
      color: #333;
      font-size: 1em;
    }
    .offer-card .actions { 
      margin-top: 10px; 
      width: 100%;
      display: flex; 
      justify-content: flex-start;
    }
    .offer-card .actions button, .offer-card a button {
      margin-right: 5px;
      background: #142541;
      color: #fff;
      border: none;
      border-radius: 4px;
      padding: 6px 12px;
      cursor: pointer;
      font-size: 1em;
      transition: background 0.2s;
    }
    .offer-card .actions button:last-child { background: #e74c3c; }
    .offer-card a button {
      background: #2274A5;
      margin-bottom: 8px;
    }
    .offer-card .actions button:hover, .offer-card a button:hover {
      background: #0e1830;
    }
    .disclaimer {
      margin-top: 3em;
      background: #fff;
      border-radius: 8px;
      padding: 1em 2em;
      color: #333;
      font-size: 0.95em;
      border: 1px solid #ddd;
      box-shadow: 0 2px 6px rgba(0,0,0,0.03);
    }
  </style>
</head>
<body>
  <nav>
    <span class="logo">GEOS Betting Admin</span>
    <div class="links">
      <a href="/">Forside</a>
      <a href="/admin-tilbud">Tilbud</a>
      <a href="/admin-brugere">Brugere</a>
      <a href="/admin-indstillinger">Indstillinger</a>
    </div>
    <div class="search-bar">
      <input type="text" id="offerSearch" placeholder="Søg tilbud..." onkeyup="searchOffers()" />
      <button onclick="searchOffers()">Søg</button>
    </div>
  </nav>

  <div class="breadcrumb">
    <a href="/">Forside</a>
    <span>&gt;</span>
    <a href="/admin-tilbud">Admin</a>
    <span>&gt;</span>
    <span>Tilbud</span>
  </div>

  <h1>Admin: Tilbud</h1>

  <form id="offerForm">
    <input type="hidden" id="offerId" />
    <label>Billede URL:</label>
    <input type="text" id="billede_url" required />
    <label>Bettingselskab:</label>
    <input type="text" id="bettingselskab" required />
    <label>Beskrivelse:</label>
    <textarea id="beskrivelse" required></textarea>
    <label>Link (URL):</label>
    <input type="text" id="link" required />
    <button type="submit">Gem</button>
    <button type="button" onclick="clearForm()">Annuller</button>
  </form>

  <div class="offers-container" id="offersContainer"></div>

  <div class="disclaimer">
    <b>Disclaimer:</b> Tilbuddene på denne side er kun til orientering og kan ændres eller fjernes uden varsel. GEOS Betting påtager sig intet ansvar for eventuelle fejl eller manglende oplysninger. Spil ansvarligt, og vær opmærksom på gældende regler og vilkår hos bettingselskaberne.
  </div>

  <script>
    // DINE SUPABASE OPLYSNINGER
    const supabase = window.supabase.createClient(
      'https://iwbvimwodjlbtxtmfqra.supabase.co',
      'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Iml3YnZpbXdvZGpsYnR4dG1mcXJhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDgwNzQ5NDYsImV4cCI6MjA2MzY1MDk0Nn0.S0M8kMbFc4cx7s6I8dNYAxFCRQICeLjRdQ_Uw1TKSTo'
    );

    let allOffers = [];

    document.getElementById('offerForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      const id = document.getElementById('offerId').value;
      const billede_url = document.getElementById('billede_url').value;
      const bettingselskab = document.getElementById('bettingselskab').value;
      const beskrivelse = document.getElementById('beskrivelse').value;
      const link = document.getElementById('link').value;

      if (id) {
        // Opdater
        await supabase.from('tilbud').update({ billede_url, bettingselskab, beskrivelse, link }).eq('id', id);
      } else {
        // Opret
        await supabase.from('tilbud').insert({ billede_url, bettingselskab, beskrivelse, link });
      }
      clearForm();
      await loadOffers();
    });

    async function loadOffers() {
      const { data } = await supabase.from('tilbud').select('*').order('id', { ascending: false });
      allOffers = data || [];
      renderOffers(allOffers);
    }

    function renderOffers(offers) {
      const container = document.getElementById('offersContainer');
      container.innerHTML = '';
      offers.forEach(offer => {
        const card = document.createElement('div');
        card.className = 'offer-card';
        card.innerHTML = `
          <img src="${offer.billede_url}" alt="Billede" />
          <h3>${offer.bettingselskab}</h3>
          <p>${offer.beskrivelse}</p>
          <a href="${offer.link}" target="_blank"><button>Tilbud</button></a>
          <div class="actions">
            <button onclick="editOffer(${offer.id},'${offer.billede_url.replace(/'/g,"\\'")}', '${offer.bettingselskab.replace(/'/g,"\\'")}', '${offer.beskrivelse.replace(/'/g,"\\'")}', '${offer.link.replace(/'/g,"\\'")}')">Rediger</button>
            <button onclick="deleteOffer(${offer.id})">Slet</button>
          </div>
        `;
        container.appendChild(card);
      });
    }

    window.editOffer = function(id, billede_url, bettingselskab, beskrivelse, link) {
      document.getElementById('offerId').value = id;
      document.getElementById('billede_url').value = billede_url;
      document.getElementById('bettingselskab').value = bettingselskab;
      document.getElementById('beskrivelse').value = beskrivelse;
      document.getElementById('link').value = link;
      window.scrollTo(0,0);
    }

    window.deleteOffer = async function(id) {
      if (confirm('Slet dette tilbud?')) {
        await supabase.from('tilbud').delete().eq('id', id);
        await loadOffers();
      }
    }

    function clearForm() {
      document.getElementById('offerId').value = '';
      document.getElementById('billede_url').value = '';
      document.getElementById('bettingselskab').value = '';
      document.getElementById('beskrivelse').value = '';
      document.getElementById('link').value = '';
    }

    // Søgning
    window.searchOffers = function() {
      const q = document.getElementById('offerSearch').value.toLowerCase().trim();
      if (!q) {
        renderOffers(allOffers);
        return;
      }
      const filtered = allOffers.filter(offer =>
        (offer.bettingselskab && offer.bettingselskab.toLowerCase().includes(q)) ||
        (offer.beskrivelse && offer.beskrivelse.toLowerCase().includes(q))
      );
      renderOffers(filtered);
    }

    loadOffers();
  </script>
</body>
</html>
