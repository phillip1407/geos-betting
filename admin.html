<!DOCTYPE html>
<html lang="da">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Admin | Geo Betting Tips</title>
  <link rel="icon" href="logo.png" type="image/png" />
  <style>
    /* -------------------- START CSS -------------------- */
    body {
      margin: 0 auto;
      max-width: 800px;
      font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      background-color: #050914;
      color: white;
    }

    h1 {
      font-weight: 600;
      font-size: 2.5rem;
      text-align: center;
      padding: 2rem 1rem 0 1rem;
    }

    h2 {
      font-weight: 600;
      font-size: 1.8rem;
      margin: 0.5rem 0;
    }

    h3 {
      font-weight: 500;
      font-size: 1.3rem;
      margin: 1rem 0 0.5rem 0;
    }

    nav {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin: 1rem 0;
    }

    button {
      background-color: #121726;
      border: none;
      border-radius: 0.4rem;
      padding: 0.5rem 1.2rem;
      font-weight: 500;
      color: white;
      cursor: pointer;
      transition: background-color 0.2s ease;
    }

    button:hover {
      background-color: #2b2e44;
    }

    input,
    textarea {
      font-family: inherit;
      font-weight: 400;
      font-size: 1rem;
      color: white;
      background-color: #121726;
      border: none;
      border-radius: 0.4rem;
      padding: 0.5rem 0.75rem;
      width: 100%;
      margin: 0.25rem 0 0.75rem 0;
      box-sizing: border-box;
    }

    label {
      font-weight: 500;
      font-size: 1.1rem;
      margin-top: 0.5rem;
      display: block;
    }

    textarea {
      resize: vertical;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 1rem;
    }

    th, td {
      border: 1px solid #1a1f36;
      padding: 0.5rem 0.75rem;
      text-align: left;
    }

    th {
      background-color: #1a1f36;
      font-weight: 600;
    }

    .error {
      color: #ff4d4d;
      margin: 0.5rem 0;
    }

    .hidden {
      display: none;
    }

    #info-box {
      background-color: #121726;
      border-radius: 0.6rem;
      padding: 1rem 1.2rem;
      margin-bottom: 1rem;
      font-size: 0.9rem;
      line-height: 1.3;
    }

    #info-box ul {
      padding-left: 1.2rem;
    }

    #info-box li {
      margin-bottom: 0.4rem;
    }

    nav button {
      min-width: 100px;
    }

    img {
      max-height: 40px;
      display: block;
    }
    /* -------------------- SLUT CSS -------------------- */
  </style>
</head>
<body>
  <h1>Admin Side | Geo Betting Tips</h1>

  <!-- LOGIN -->
  <div id="login-section">
    <h2>Log ind</h2>
    <label for="email">Email:</label>
    <input id="email" type="email" placeholder="Din email" />
    <label for="password">Password:</label>
    <input id="password" type="password" placeholder="Dit password" />
    <button id="login-btn">Log ind</button>
    <p class="error" id="login-error"></p>
  </div>

  <!-- ADMIN -->
  <div id="admin-section" class="hidden">
    <section id="info-box">
      <h2>Information</h2>
      <ul>
        <li>✔  - Du kan tilføje, redigere og slette nyheder og dagens spil.</li>
        <li>✔  - Husk at udfylde alle påkrævede felter (titel, dato, indhold, odds osv.) før du gemmer.</li>
        <li>✔  - Billede-URLs skal være gyldige links til billeder (f.eks. .jpg, .png).</li>
        <li>❌ - Du må <strong>ikke</strong> indsætte skadelige eller upassende data (som kode eller ugyldige links).</li>
        <li>❌ - Undgå at slette indhold, medmindre du er helt sikker, da data ikke kan gendannes.</li>
      </ul>
    </section>

    <nav>
      <button id="logout-btn">Log ud</button>
      <button id="show-news-btn">Nyheder</button>
      <button id="show-dagensspil-btn">Dagens Spil</button>
    </nav>

    <!-- NYHEDER -->
    <section id="news-section" class="hidden">
      <h2>Opret nyhed</h2>
      <label for="news-title">Titel</label>
      <input id="news-title" type="text" placeholder="Nyhedens titel" />
      <label for="news-date">Dato</label>
      <input id="news-date" type="date" />
      <label for="news-image">Billede URL</label>
      <input id="news-image" type="text" placeholder="URL til billede" />
      <label for="news-content">Indhold</label>
      <textarea id="news-content" rows="5" placeholder="Indhold af nyheden"></textarea>
      <button id="add-news-btn">Tilføj nyhed</button>
      <p class="error" id="news-error"></p>

      <h3>Eksisterende nyheder</h3>
      <table id="news-table">
        <thead>
          <tr>
            <th>ID</th>
            <th>Titel</th>
            <th>Dato</th>
            <th>Handling</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </section>

    <!-- DAGENS SPIL -->
    <section id="dagensspil-section" class="hidden">
      <h2>Opret Dagens Spil til GeoBet.dk</h2>
      <form id="dagensspil-form">
        <label for="dagensspil-tidspunkt">Tidspunkt:</label>
        <input type="text" id="dagensspil-tidspunkt" name="tidspunkt" placeholder="Tidspunkt (fx 20:45)" required />

        <label for="dagensspil-liga">Liga:</label>
        <input type="text" id="dagensspil-liga" name="liga" placeholder="Liga (fx Premier League)" required />

        <label for="dagensspil-hjemme-logo">Hjemme_logo:</label>
        <input type="url" id="dagensspil-hjemme-logo" name="hjemme_logo" placeholder="URL til hjemmeholdets logo" required />

        <label for="dagensspil-hjemmehold">Hjemmehold:</label>
        <input type="text" id="dagensspil-hjemmehold" name="hjemmehold" placeholder="Hjemmeholdets navn" required />

        <label for="dagensspil-ude-logo">Ude_logo:</label>
        <input type="url" id="dagensspil-ude-logo" name="ude_logo" placeholder="URL til udeholdets logo" required />

        <label for="dagensspil-udehold">Udehold:</label>
        <input type="text" id="dagensspil-udehold" name="udehold" placeholder="Udeholdets navn" required />

        <label for="dagensspil-odds">Odds:</label>
        <input type="text" id="dagensspil-odds" name="odds" placeholder="Odds (fx 2.50)" required />

        <label for="dagensspil-ekspert">Ekspert:</label>
        <input type="text" id="dagensspil-ekspert" name="ekspert" placeholder="Navn på ekspert" required />

        <button type="submit">Gem Dagens Spil</button>
      </form>

      <p class="error" id="dagensspil-error"></p>

      <h3>Eksisterende Dagens Spil</h3>
      <table id="dagensspil-table">
        <thead>
          <tr>
            <th>ID</th>
            <th>Tidspunkt</th>
            <th>Hjemmehold</th>
            <th>Hjemmehold Logo</th>
            <th>Udehold</th>
            <th>Udehold Logo</th>
            <th>Odds</th>
            <th>Ekspert</th>
            <th>Handling</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </section>
  </div>

  <script type="module">
    import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";

    const SUPABASE_URL = "https://iwbvimwodjlbtxtmfqra.supabase.co";
    const SUPABASE_ANON_KEY = "YOUR_ANON_KEY_HERE";

    const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    // Elementer
    const loginSection = document.getElementById("login-section");
    const adminSection = document.getElementById("admin-section");

    const loginBtn = document.getElementById("login-btn");
    const logoutBtn = document.getElementById("logout-btn");
    const loginError = document.getElementById("login-error");

    const showNewsBtn = document.getElementById("show-news-btn");
    const showDagensspilBtn = document.getElementById("show-dagensspil-btn");

    const newsSection = document.getElementById("news-section");
    const dagensspilSection = document.getElementById("dagensspil-section");

    // Nyhed inputs
    const newsTitle = document.getElementById("news-title");
    const newsDate = document.getElementById("news-date");
    const newsImage = document.getElementById("news-image");
    const newsContent = document.getElementById("news-content");
    const addNewsBtn = document.getElementById("add-news-btn");
    const newsError = document.getElementById("news-error");
    const newsTableBody = document.querySelector("#news-table tbody");

    // Dagens Spil inputs
    const dagensspilForm = document.getElementById("dagensspil-form");
    const dagensspilError = document.getElementById("dagensspil-error");
    const dagensspilTableBody = document.querySelector("#dagensspil-table tbody");

    // LOGIN
    loginBtn.addEventListener("click", async () => {
      loginError.textContent = "";
      const email = document.getElementById("email").value.trim();
      const password = document.getElementById("password").value.trim();

      if (!email || !password) {
        loginError.textContent = "Udfyld både email og password.";
        return;
      }

      const { error } = await supabase.auth.signInWithPassword({ email, password });
      if (error) {
        loginError.textContent = "Login fejlede: " + error.message;
      } else {
        loginSection.classList.add("hidden");
        adminSection.classList.remove("hidden");
        await loadNews();
        await loadBets();
        showNewsBtn.click();
      }
    });

    // LOGOUT
    logoutBtn.addEventListener("click", async () => {
      await supabase.auth.signOut();
      adminSection.classList.add("hidden");
      loginSection.classList.remove("hidden");
      clearInputs();
      clearTables();
    });

    // Vis sektioner
    showNewsBtn.addEventListener("click", () => {
      newsSection.classList.remove("hidden");
      dagensspilSection.classList.add("hidden");
    });

    showDagensspilBtn.addEventListener("click", () => {
      newsSection.classList.add("hidden");
      dagensspilSection.classList.remove("hidden");
    });

    // Tilføj nyhed
    addNewsBtn.addEventListener("click", async () => {
      newsError.textContent = "";
      const title = newsTitle.value.trim();
      const date = newsDate.value;
      const image = newsImage.value.trim();
      const content = newsContent.value.trim();

      if (!title || !date || !content) {
        newsError.textContent = "Titel, dato og indhold skal udfyldes.";
        return;
      }

      const { error } = await supabase.from("news").insert([{ title, date, image, content }]);

      if (error) {
        newsError.textContent = "Fejl ved tilføjelse: " + error.message;
      } else {
        clearNewsInputs();
        await loadNews();
      }
    });

    // Hent og vis nyheder
    async function loadNews() {
      const { data, error } = await supabase.from("news").select("*").order("id", { ascending: false });
      if (error) {
        newsError.textContent = "Fejl ved hentning af nyheder: " + error.message;
        return;
      }

      newsTableBody.innerHTML = "";
      data.forEach((news) => {
        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${news.id}</td>
          <td>${news.title}</td>
          <td>${news.date}</td>
          <td><button data-id="${news.id}" class="delete-news-btn">Slet</button></td>
        `;
        newsTableBody.appendChild(row);
      });

      // Tilføj slet-funktion til knapper
      document.querySelectorAll(".delete-news-btn").forEach((btn) => {
        btn.addEventListener("click", async (e) => {
          const id = e.target.dataset.id;
          await supabase.from("news").delete().eq("id", id);
          await loadNews();
        });
      });
    }

    // Dagens Spil - Submit event på form
    dagensspilForm.addEventListener("submit", async (e) => {
      e.preventDefault();
      dagensspilError.textContent = "";

      const tidspunkt = document.getElementById("dagensspil-tidspunkt").value.trim();
      const liga = document.getElementById("dagensspil-liga").value.trim();
      const hjemme_logo = document.getElementById("dagensspil-hjemme-logo").value.trim();
      const hjemmehold = document.getElementById("dagensspil-hjemmehold").value.trim();
      const ude_logo = document.getElementById("dagensspil-ude-logo").value.trim();
      const udehold = document.getElementById("dagensspil-udehold").value.trim();
      const odds = document.getElementById("dagensspil-odds").value.trim();
      const ekspert = document.getElementById("dagensspil-ekspert").value.trim();

      if (!tidspunkt || !liga || !hjemme_logo || !hjemmehold || !ude_logo || !udehold || !odds || !ekspert) {
        dagensspilError.textContent = "Alle felter skal udfyldes.";
        return;
      }

      const { error } = await supabase.from("dagensspil").insert([{
        tidspunkt,
        liga,
        hjemme_logo,
        hjemmehold,
        ude_logo,
        udehold,
        odds,
        ekspert,
      }]);

      if (error) {
        dagensspilError.textContent = "Fejl ved tilføjelse: " + error.message;
      } else {
        dagensspilForm.reset();
        await loadBets();
      }
    });

    // Hent og vis dagens spil
    async function loadBets() {
      const { data, error } = await supabase.from("dagensspil").select("*").order("id", { ascending: false });
      if (error) {
        dagensspilError.textContent = "Fejl ved hentning af dagens spil: " + error.message;
        return;
      }

      dagensspilTableBody.innerHTML = "";
      data.forEach((bet) => {
        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${bet.id}</td>
          <td>${bet.tidspunkt}</td>
          <td>${bet.hjemmehold}</td>
          <td><img src="${bet.hjemme_logo}" alt="Hjemmehold logo" /></td>
          <td>${bet.udehold}</td>
          <td><img src="${bet.ude_logo}" alt="Udehold logo" /></td>
          <td>${bet.odds}</td>
          <td>${bet.ekspert}</td>
          <td><button data-id="${bet.id}" class="delete-bet-btn">Slet</button></td>
        `;
        dagensspilTableBody.appendChild(row);
      });

      // Slet-funktion for dagens spil
      document.querySelectorAll(".delete-bet-btn").forEach((btn) => {
        btn.addEventListener("click", async (e) => {
          const id = e.target.dataset.id;
          await supabase.from("dagensspil").delete().eq("id", id);
          await loadBets();
        });
      });
    }

    // Ryd inputs efter tilføjelse
    function clearNewsInputs() {
      newsTitle.value = "";
      newsDate.value = "";
      newsImage.value = "";
      newsContent.value = "";
      newsError.textContent = "";
    }

    // Ryd alle inputs og tabeller ved logout
    function clearInputs() {
      document.getElementById("email").value = "";
      document.getElementById("password").value = "";
      clearNewsInputs();
      dagensspilForm.reset();
      loginError.textContent = "";
      dagensspilError.textContent = "";
      newsError.textContent = "";
    }

    function clearTables() {
      newsTableBody.innerHTML = "";
      dagensspilTableBody.innerHTML = "";
    }

    // Auto login check ved sideindlæsning
    (async () => {
      const { data: { user } } = await supabase.auth.getUser();
      if (user) {
        loginSection.classList.add("hidden");
        adminSection.classList.remove("hidden");
        await loadNews();
        await loadBets();
        showNewsBtn.click();
      }
    })();
  </script>
</body>
</html>
